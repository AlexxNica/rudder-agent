#!/bin/sh
# @description force run agent promises
# @man This command will force the agent to enforce current policies.
# @man You can run *rudder agent update* before to update the promises.
# @man +
# @man *Options*:
# @man +
# @man *-v*: run the agent in verbose mode
# @man +
# @man *-q*: run the agent in quiet mode (display only error messages)

VERBOSE=""
FILTER="cat"

while getopts "vq" opt; do
  case $opt in
    v)
      VERBOSE="-v"
      ;;
    q)
      FILTER="egrep -v @@result_success@@|@@result_na@@|@@log_info@@|@@log_debug@@|\[info\]|notice:"
      ;;
  esac
done

/var/rudder/cfengine-community/bin/cf-agent ${VERBOSE} -Calways -K | ${FILTER}
