#!/bin/sh
# @description force the agent to create and send a new inventory
# @man This will trigger a new inventory creation and send it to the policy server.
# @man Even if the agent will do it regularly, it can be used to force the update
# @man after a modification on the node.
# @man This won't affect the node state, but only update server-side information.
# @man +
# @man *Options*:
# @man +
# @man *-q*: run the agent in quiet mode (display only error messages)



FILTER="cat"

while getopts "q" opt; do
  case $opt in
    q)
      FILTER="egrep -v @@result_success@@|@@result_na@@|@@log_info@@|@@log_debug@@|\[info\]|notice:"
      ;;
  esac
done

/var/rudder/cfengine-community/bin/cf-agent -Calways -K -D force_inventory | ${FILTER}
